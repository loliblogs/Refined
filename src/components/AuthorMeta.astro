---
/**
 * 作者信息组件 - 匹配 Concise 主题样式
 */
import IdentificationCardDuotone from '@phosphor-icons/core/assets/duotone/identification-card-duotone.svg';
import MapPin from '@phosphor-icons/core/assets/regular/map-pin.svg';

import { getPageUrl } from '@/utils/collection-paths';
import { getSiteConfig } from '@/config/site.config';
import type { CollectionName } from '@/types/content';

import SocialLinks from './SocialLinks.astro';

import { Picture } from 'astro:assets';

interface Props {
  collection?: CollectionName;
}

const { collection = 'post' } = Astro.props;

const config = getSiteConfig(collection);
---

<address class="w-full text-center leading-8 text-primary not-italic">
  <div class="flex justify-center pb-6">
    <a href={getPageUrl(config.author.avatar.href, collection)} class="group">
      <div
        class="
          relative overflow-hidden rounded-full transition-transform
          duration-200 ease-in-out
          group-hover:scale-110
        "
      >
        <Picture
          src={config.author.avatar.src}
          alt={config.author.avatar.alt}
          width={config.author.avatar.width}
          height={config.author.avatar.height}
          widths={[
            config.author.avatar.width,
            config.author.avatar.width * 1.25,
            config.author.avatar.width * 1.5,
            config.author.avatar.width * 1.75,
            config.author.avatar.width * 2,
            config.author.avatar.width * 2.5,
            config.author.avatar.width * 3.5,
            config.author.avatar.width * 5,
          ]}
          formats={['avif']}
          fallbackFormat="webp"
          sizes={`calc(clamp(1rem, 0.85rem + 0.15vw, 1.25rem) * ${config.author.avatar.width / 16})`}
          style={{
            width: `${config.author.avatar.width / 16}rem`,
            height: `${config.author.avatar.height / 16}rem`,
          }}
          priority
        />
        <div
          class="
            pointer-events-none absolute inset-0 flex items-center
            justify-center bg-black/0
            transition-[background-color,backdrop-filter] duration-200
            ease-in-out
            group-hover:bg-black/20 group-hover:backdrop-blur-[2px]
            [@media(prefers-reduced-transparency:reduce)]:hidden
          "
        >
          <span
            class="
              text-white opacity-0 drop-shadow-md transition-opacity
              duration-200 ease-in-out
              group-hover:opacity-100
            "
          >
            <IdentificationCardDuotone width="3rem" height="3rem" />
          </span>
        </div>
      </div>
    </a>
  </div>

  {/* author 信息已在配置层预处理，直接使用 set:html */}
  <p class="text-2xl/10 text-primary" set:html={config.author.name} />
  {config.author.work && (
    <p class="text-base/10 text-secondary" set:html={config.author.work} />
  )}
  <div class="mt-2 flex items-center justify-center text-sm/8 text-secondary">
    <MapPin width="1rem" height="1rem" />
    <p class="ml-1" set:html={config.author.location} />
  </div>

  {config.links.length > 0 && (
    <SocialLinks links={config.links} />
  )}
</address>
