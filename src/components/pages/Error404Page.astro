---
/**
 * 404错误页面组件 - 支持多collection
 * 完全兼容原始404.astro的行为
 */

import { posix } from 'node:path';

import BaseLayout from '@/layouts/BaseLayout.astro';
import { getBasePath } from '@/utils/collection-paths';

import type { CollectionName } from '@/types/content';
import Comments from '@/config/comments.config';
import { getSiteConfig } from '@/config/site.config';

interface Props {
  collection?: CollectionName;
}

const { collection = 'post' } = Astro.props;

const config = getSiteConfig(collection);

// 决定是否显示评论
const showComments = config.comments;

// 页面上下文
const pageContext = {
  path: posix.join(getBasePath(collection), '404'),
  collection,
  noindex: true,
};
---

<BaseLayout title="404 - Page Not Found" pageContext={pageContext}>
  <div class="flex grow items-center justify-center">
    <div class="w-full text-center">
      <h1 class="mb-4 text-6xl font-bold text-primary">404</h1>
      <p class="mb-8 text-xl text-secondary">你是怎么进来的？</p>
      <a
        href={getBasePath(collection)}
        class={`
          text-link
          hover:text-link-hover
        `}
      >
        返回首页
      </a>
      {showComments && (
        <section class="mt-12 border-t border-line pt-8">
          <Comments
            collection={collection}
            term={`/special-page${pageContext.path}`}
            client:load
          />
        </section>
      )}
    </div>
  </div>
</BaseLayout>
