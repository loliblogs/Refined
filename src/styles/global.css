@import "tailwindcss";

@import "./markdown.css";
@import "./mathjax.css";
@import "./jetbrains-mono.css";
@import "./typography.css";

/* Tailwind CSS v4 Theme Configuration */
@theme {
  /* Custom colors - Tailwind v4 需要在 @theme 中声明所有颜色 */
  --color-primary: var(--color-primary);
  --color-secondary: var(--color-secondary);
  --color-muted: var(--color-muted);
  --color-hover: var(--color-hover);
  --color-active: var(--color-active);
  --color-line: var(--color-line);    /* 高对比度边框 - 日常使用 */
  --color-soft: var(--color-soft);    /* 低对比度边框 - 结构边界 */
  --color-link: var(--color-link);
  --color-link-hover: var(--color-link-hover);
  --color-overlay: var(--color-overlay);
  --color-red: var(--color-red);
  --color-highlight: var(--color-highlight);
  --color-code: var(--color-code);

  /* Admonition colors - GitHub-style */
  --color-admonition-note: var(--color-admonition-note);
  --color-admonition-tip: var(--color-admonition-tip);
  --color-admonition-important: var(--color-admonition-important);
  --color-admonition-warning: var(--color-admonition-warning);
  --color-admonition-caution: var(--color-admonition-caution);

  /* 背景色 - surface 表示"表面" */
  --color-surface: var(--color-surface);            /* 主背景 */
  --color-surface-aside: var(--color-surface-aside);  /* 侧边栏背景 */
  --color-surface-nav: var(--color-surface-nav);      /* 导航栏背景 */

  /* Shadows */
  --shadow-md: var(--shadow-md);
  
  /* 扩展Tailwind的spacing系统 - 定义特殊值 */
  --spacing-header: 24rem;        /* 384px - 8的倍数 */
  --spacing-aside: 19rem;         /* 304px - 8的倍数 */
  --spacing-aside-min: 16rem;     /* 256px - 侧边栏最小宽度 */
  --spacing-nav: 5rem;            /* 80px - navigation bar width */
  --spacing-nav-height: 3rem;     /* 48px - navigation item height */
  --spacing-footer: 2.5rem;       /* 40px - footer height */
  --spacing-content-max: 50rem;   /* 800px - content max width */

  --leading-markdown: 1.8;

  /* 字体定义 - Tailwind v4 @theme 声明 */
  --font-sans: var(--font-sans);

  /* 响应式根字号 */
  --text-root: var(--base-font-size);

  /* 搜索框动态高度 - 使用CSS变量计算 */
  --search-min-h: 25rem;
  --search-space: var(--viewport-height-search); /* 使用统一的视口高度变量 */

  /* 视口高度 */
  --spacing-viewport-height: var(--viewport-height);
}

/* CSS Variables - Matching Concise Theme Exactly */
:root {
  /* Base font size for responsive scaling */
  --base-font-size: clamp(1rem, 0.85rem + 0.15vw, 1.25rem);
  --base-zoom: calc(var(--base-font-size) / 1rem);
  
  /* 
   * 视口高度统一管理 - "消除特殊情况" - Linus
   * 默认使用 100vh，支持 dvh 时自动升级
   */
  --viewport-height: 100vh; /* 基础降级值 */
  --viewport-height-search: calc(100vh - 9rem); /* 搜索框专用 */
  
  /* Core colors from Concise theme */
  --color-red: #fd413c;
  --color-surface: #ffffff;
  --color-surface-nav: #f0f0f0;   /* 导航栏：比 aside 稍深 */
  --color-surface-aside: #f9f9f9; /* 侧边栏 */
  --color-primary: #1a1a1a;
  --color-secondary: #4d4d4d;
  --color-muted: #686868;
  --color-hover: #e3e3e3;
  --color-active: #d9d9d9;
  --color-line: #949494;    /* 高对比度边框 - WCAG 3:1 */
  --color-soft: #dddddd;    /* 低对比度边框 - 结构边界 */
  --color-link: #0366d6;
  --color-link-hover: #0256c7;
  
  /* 滚动条样式 - noscript.css 和 os-theme-modern 共用 */
  --scrollbar-size: 0.375rem;
  --scrollbar-size-hover: 0.5rem;
  --scrollbar-thumb-radius: 0.25rem;
  --scrollbar-thumb: #a0a0a0;
  --scrollbar-thumb-hover: var(--color-secondary);
  --scrollbar-track: transparent;

  /* 其他颜色 */
  --color-highlight: #fff3bf;
  --color-code: #d9d9d9;
  --color-kbd: #e9e9e9;

  --color-skeleton: #f2f2f2;       
  --color-skeleton-shine: #ffffff;
  --color-outline-focus: #0366d666;

  /* Admonition colors - GitHub-style */
  --color-admonition-note: #0969da;
  --color-admonition-tip: #1a7f37;
  --color-admonition-important: #8250df;
  --color-admonition-warning: #9a6700;
  --color-admonition-caution: #cf222e;

  /* Overlay */
  --color-overlay: rgba(0, 0, 0, 0.5);
  
  /* Shadows */
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  
  /* Fonts */
  --font-sans: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  --font-mono: 'JetBrains Mono Variable', ui-monospace, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', "Noto Color Emoji";
}

/* Dark mode - Matching Concise theme */
@media (prefers-color-scheme: dark) {
  :root {
    --color-surface: #2b2e32;
    --color-surface-nav: #22252a;
    --color-surface-aside: #282b30;
    --color-primary: #f0f0f0;
    --color-secondary: #b5b5b5;
    --color-muted: #9a9a9a;
    --color-hover: #42454a;
    --color-active: #4a4e54;
    --color-line: #757575;    /* 高对比度边框 - WCAG 3:1 */
    --color-soft: #434343;    /* 低对比度边框 - 结构边界 */
    --color-link: #ff7b72;
    --color-link-hover: #ff9999;
    --scrollbar-thumb: #52525b;
    --color-highlight: #5a4a1a;
    --color-code: #4a4e54;
    --color-kbd: #393c42;

    --color-skeleton: #383b40;     
    --color-skeleton-shine: #45484d;
    --color-outline-focus: #ff7b7266;

    /* Admonition colors for dark mode */
    --color-admonition-note: #58a6ff;
    --color-admonition-tip: #3fb950;
    --color-admonition-important: #bc8cff;
    --color-admonition-warning: #d29922;
    --color-admonition-caution: #ff7b72;

    /* Overlay for dark mode */
    --color-overlay: rgba(0, 0, 0, 0.7);
    
    /* Shadows for dark mode */
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
  }
}

/* iOS Safari 额外降级（-webkit-fill-available）*/
@supports (-webkit-touch-callout: none) {
  :root {
    --viewport-height: -webkit-fill-available;
    --viewport-height-search: calc(-webkit-fill-available - 9rem);
  }
}

/* 最终升级到 dvh（优先级最高）*/
@supports (height: 100dvh) {
  :root {
    --viewport-height: 100dvh;
    --viewport-height-search: calc(100dvh - 9rem);
  }
}

/* Animation keyframes */
@keyframes fade-in-down {
  from {
    opacity: 0;
    transform: translate3d(0, -0.625rem, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes aside-fade-in-left {
  from {
    transform: translate3d(-100%, 0, 0);
  }
  to {
    transform: translate3d(0, 0, 0);
  }
}

@keyframes aside-fade-in-right {
  from {
    opacity: 0;
    transform: translate3d(-100%, 0, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

/* 解密动画 */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translate3d(0, 0.625rem, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes shake {
  0% { transform: translate3d(0, 0, 0); }
  12.5% { transform: translate3d(-1rem, 0, 0); }
  37.5% { transform: translate3d(1rem, 0, 0); }
  62.5% { transform: translate3d(-1rem, 0, 0); }
  87.5% { transform: translate3d(1rem, 0, 0); }
  100% { transform: translate3d(0, 0, 0); }
}

@keyframes fade-out-up {
  from {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
  to {
    opacity: 0;
    transform: translate3d(0, -1.25rem, 0);
  }
}

/* TimelineFilter focus高亮动画 */
@keyframes highlight-flash {
  0% { background-color: transparent; }
  50% { background-color: var(--color-hover); }
  100% { background-color: transparent; }
}

/* 自定义主题 - os-theme-modern，使用 :root 中的 --scrollbar-* 变量 */
.os-theme-modern {
  /* 尺寸 */
  --os-size: var(--scrollbar-size);
  --os-size-hover: var(--scrollbar-size-hover);
  --os-padding-perpendicular: 0;
  --os-padding-axis: 0;

  /* 轨道 */
  --os-track-border-radius: 0;
  --os-track-bg: var(--scrollbar-track);
  --os-track-bg-hover: var(--scrollbar-track);
  --os-track-bg-active: var(--scrollbar-track);

  /* 滑块 */
  --os-handle-border-radius: var(--scrollbar-thumb-radius);
  --os-handle-bg: var(--scrollbar-thumb);
  --os-handle-bg-hover: var(--scrollbar-thumb-hover);
  --os-handle-bg-active: var(--color-primary);

  /* 交互区域 */
  --os-handle-interactive-area-offset: var(--scrollbar-thumb-radius);
  --os-handle-perpendicular-size: 100%;
  --os-handle-perpendicular-size-hover: 100%;
  --os-handle-perpendicular-size-active: 100%;
}

/*
 * 平滑滚动 - 仅在 OverlayScrollbars 初始化完成后启用
 *
 * 为什么不在 initialize 上设置？
 * initialize 是初始化前的容器，若设置 smooth，用户点击锚点后
 * OverlayScrollbars 初始化会打断正在进行的平滑滚动，导致跳转失败。
 *
 * 无 JS 时的 smooth 由 noscript.css 处理（不会有初始化打断问题）
 */
 [data-overlayscrollbars-viewport] {
  scroll-behavior: smooth;
}

/* 代码块 - 内容隔离 */
.expressive-code {
  contain: content;
}

/* 代码块 - 行号间距 */
.expressive-code .ec-line .gutter .ln {
  padding-inline: 1.75ch;
}

@media print {
  /*
   * OverlayScrollbars 打印重置
   * - host/padding: flex → block, hidden → visible
   * - viewport: relative → static（允许跨页），重置 JS inline style
   */
  html [data-overlayscrollbars~="host"],
  html [data-overlayscrollbars-padding] {
    display: block !important;
    overflow: visible !important;
  }

  html [data-overlayscrollbars-viewport] {
    position: static !important;
    overflow: visible !important;
    width: auto !important;
    margin: 0 !important;
    padding: 0 !important;
  }
}

/* 打印/e-ink 暗色模式 - 纯黑背景省墨水/电 */
@media print and (prefers-color-scheme: dark),
       (monochrome) and (update: slow) and (prefers-color-scheme: dark) {
  :root {
    --color-bg: #000000;
  }
}

/* 尊重用户的动画偏好设置 - 无障碍支持 */
@media (prefers-reduced-motion: reduce), (update: slow) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  /* 保留关键状态变化，但移除动画效果 */
  .content-animate {
    transition: none !important;
  }
  
  /* 禁用 View Transitions */
  ::view-transition-group(*),
  ::view-transition-old(*),
  ::view-transition-new(*) {
    animation: none !important;
  }
}

/* 单色设备 - e-ink、黑白打印、高刷单色屏 */
@media (monochrome) {
  :root {
    --color-link: var(--color-primary);
    --color-link-hover: var(--color-primary);
    --color-admonition-note: var(--color-primary);
    --color-admonition-tip: var(--color-primary);
    --color-admonition-important: var(--color-primary);
    --color-admonition-warning: var(--color-primary);
    --color-admonition-caution: var(--color-primary);
  }
}

/* 低刷新率/单色设备 - 禁用阴影 */
@media (monochrome), (update: slow) {
  :root {
    --shadow-md: none;
  }
}

/* 减少透明度偏好 - 视觉障碍辅助 */
@media (prefers-reduced-transparency: reduce) {
  :root {
    --color-overlay: #707070;
  }
}

@media (prefers-reduced-transparency: reduce) and (prefers-color-scheme: dark) {
  :root {
    --color-overlay: #141416;
  }
}
