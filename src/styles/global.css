@import "tailwindcss";

@import "./markdown.css";
@import "./mathjax.css";
@import "./jetbrains-mono.css";
@import "./typography.css";
@import "./toc.css";

/* Tailwind CSS v4 Theme Configuration */
@theme {
  /* Custom colors - Tailwind v4 需要在 @theme 中声明所有颜色 */
  --color-primary: var(--color-primary);
  --color-secondary: var(--color-secondary);
  --color-muted: var(--color-muted);
  --color-hover: var(--color-hover);
  --color-active: var(--color-active);
  --color-border: var(--color-border);
  --color-link: var(--color-link);
  --color-link-hover: var(--color-link-hover);
  --color-nav: var(--color-nav);
  --color-aside: var(--color-aside);
  --color-overlay: var(--color-overlay);
  --color-red: var(--color-red);
  --color-highlight: var(--color-highlight);

  /* Admonition colors - GitHub-style */
  --color-admonition-note: var(--color-admonition-note);
  --color-admonition-tip: var(--color-admonition-tip);
  --color-admonition-important: var(--color-admonition-important);
  --color-admonition-warning: var(--color-admonition-warning);
  --color-admonition-caution: var(--color-admonition-caution);

  /* 别名，为了兼容性 */
  --color-line: var(--color-border);  /* border-line别名 */
  --color-surface: var(--color-bg);    /* bg-surface别名 */
  --color-surface-aside: var(--color-aside);  /* bg-surface-aside别名 */
  --color-surface-nav: var(--color-nav);      /* bg-surface-nav别名 */

  /* Shadows - 让shadow工具类可用 */
  --shadow-sm: var(--shadow-sm);
  --shadow: var(--shadow);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  
  /* 扩展Tailwind的spacing系统 - 定义特殊值 */
  --spacing-header: 24rem;        /* 384px - 8的倍数 */
  --spacing-aside: 19rem;         /* 304px - 8的倍数 */
  --spacing-aside-min: 16rem;     /* 256px - 侧边栏最小宽度 */
  --spacing-nav: 5rem;            /* 80px - navigation bar width */
  --spacing-nav-height: 3rem;     /* 48px - navigation item height */
  --spacing-footer: 2.5rem;       /* 40px - footer height */
  --spacing-content-max: 50rem;   /* 800px - content max width */

  --leading-markdown: 1.8;
  
  /* 搜索框动态高度 - 使用CSS变量计算 */
  --search-min-h: 25rem;
  --search-space: var(--viewport-height-search); /* 使用统一的视口高度变量 */

  /* 视口高度 */
  --spacing-viewport-height: var(--viewport-height);
}

/* CSS Variables - Matching Concise Theme Exactly */
:root {
  /* Base font size for responsive scaling */
  --base-font-size: clamp(1rem, 0.85rem + 0.15vw, 1.25rem);
  
  /* 
   * 视口高度统一管理 - "消除特殊情况" - Linus
   * 默认使用 100vh，支持 dvh 时自动升级
   */
  --viewport-height: 100vh; /* 基础降级值 */
  --viewport-height-search: calc(100vh - 9rem); /* 搜索框专用 */
  
  /* Core colors from Concise theme */
  --color-red: #fd413c;
  --color-bg: #ffffff;
  --color-primary: #1a1a1a;
  --color-secondary: #4d4d4d;
  --color-muted: #686868;
  --color-hover: #e3e3e3;
  --color-active: #d9d9d9;
  --color-border: #dddddd;
  --color-link: #0366d6;
  --color-link-hover: #0256c7;
  --color-nav: #f0f0f0;  /* 浅色模式：比 aside 稍深的浅灰 */
  --color-aside: #f9f9f9;
  
  /* Additional colors for convenience */
  --color-scrollbar-thumb: #a0a0a0;
  --color-highlight: #fff3bf;

  /* Admonition colors - GitHub-style */
  --color-admonition-note: #0969da;
  --color-admonition-tip: #1a7f37;
  --color-admonition-important: #8250df;
  --color-admonition-warning: #9a6700;
  --color-admonition-caution: #cf222e;

  /* Overlay */
  --color-overlay: rgba(0, 0, 0, 0.5);
  
  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
  
  /* Fonts */
  --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  --font-mono: "JetBrains Mono Variable", ui-monospace, monospace;
}

/* Dark mode - Matching Concise theme */
@media (prefers-color-scheme: dark) {
  :root {
    --color-bg: #2b2e32;
    --color-primary: #f0f0f0;
    --color-secondary: #b5b5b5;
    --color-muted: #9a9a9a;
    --color-hover: #42454a;
    --color-active: #4a4e54;
    --color-border: #434343;
    --color-link: #ff7b72;
    --color-link-hover: #ff9999;
    --color-nav: #22252a;
    --color-aside: #282b30;
    --color-scrollbar-thumb: #52525b;
    --color-highlight: #5a4a1a;

    /* Admonition colors for dark mode */
    --color-admonition-note: #58a6ff;
    --color-admonition-tip: #3fb950;
    --color-admonition-important: #bc8cff;
    --color-admonition-warning: #d29922;
    --color-admonition-caution: #ff7b72;

    /* Overlay for dark mode */
    --color-overlay: rgba(0, 0, 0, 0.7);
    
    /* Shadows for dark mode */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.1);
    --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.2), 0 1px 2px -1px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
  }
}

/* iOS Safari 额外降级（-webkit-fill-available）*/
@supports (-webkit-touch-callout: none) {
  :root {
    --viewport-height: -webkit-fill-available;
    --viewport-height-search: calc(-webkit-fill-available - 9rem);
  }
}

/* 最终升级到 dvh（优先级最高）*/
@supports (height: 100dvh) {
  :root {
    --viewport-height: 100dvh;
    --viewport-height-search: calc(100dvh - 9rem);
  }
}

html {
  font-family: var(--font-sans);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-size: var(--base-font-size);
}

[data-overlayscrollbars-viewport] {
  scroll-behavior: smooth;
}

/* Animation keyframes */
@keyframes fade-in-down {
  from {
    opacity: 0;
    transform: translate3d(0, -0.625rem, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes aside-fade-in-left {
  from {
    transform: translate3d(-100%, 0, 0);
  }
  to {
    transform: translate3d(0, 0, 0);
  }
}

@keyframes aside-fade-in-right {
  from {
    opacity: 0;
    transform: translate3d(-100%, 0, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

/* 解密动画 */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translate3d(0, 0.625rem, 0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

@keyframes shake {
  0% { transform: translate3d(0, 0, 0); }
  12.5% { transform: translate3d(-1rem, 0, 0); }
  37.5% { transform: translate3d(1rem, 0, 0); }
  62.5% { transform: translate3d(-1rem, 0, 0); }
  87.5% { transform: translate3d(1rem, 0, 0); }
  100% { transform: translate3d(0, 0, 0); }
}

@keyframes fade-out-up {
  from {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
  to {
    opacity: 0;
    transform: translate3d(0, -1.25rem, 0);
  }
}

/* TimelineFilter focus高亮动画 */
@keyframes highlight-flash {
  0% { background-color: transparent; }
  50% { background-color: var(--color-hover); }
  100% { background-color: transparent; }
}

/* 自定义主题 - os-theme-modern */
.os-theme-modern {
  /* 尺寸优化 */
  --os-size: 0.375rem;
  --os-size-hover: 0.5rem;
  --os-padding-perpendicular: 0;
  --os-padding-axis: 0;
  
  /* 轨道完全透明 */
  --os-track-border-radius: 0;
  --os-track-bg: transparent;
  --os-track-bg-hover: transparent;
  --os-track-bg-active: transparent;
  
  /* 滑块使用项目颜色系统 */
  --os-handle-border-radius: 0.25rem;
  --os-handle-bg: var(--color-scrollbar-thumb);
  --os-handle-bg-hover: var(--color-secondary);
  --os-handle-bg-active: var(--color-primary);
  
  /* 交互区域 */
  --os-handle-interactive-area-offset: 0.25rem;
  --os-handle-perpendicular-size: 100%;
  --os-handle-perpendicular-size-hover: 100%;
  --os-handle-perpendicular-size-active: 100%;
}

/* All Code blocks */
.expressive-code .frame pre {
  margin-bottom: 1em;
}

.expressive-code .ec-line .gutter .ln {
  padding-inline: 1.75ch;
}

/* 尊重用户的动画偏好设置 - 无障碍支持 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  /* 保留关键状态变化，但移除动画效果 */
  .content-animate {
    transition: none !important;
  }
  
  /* 禁用 View Transitions */
  ::view-transition-group(*),
  ::view-transition-old(*),
  ::view-transition-new(*) {
    animation: none !important;
  }
}
